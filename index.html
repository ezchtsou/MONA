<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ–°é€²å“¡å·¥è¨“ç·´å›é¥‹ç³»çµ± | MONA Onboarding Feedback</title>
  <style>
    :root{--bg:#f8fafc;--card:#ffffff;--text:#1f2937;--muted:#6b7280;--brand:#0ea5e9;--active:#dbeafe;--danger:#fecaca}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans CJK TC",sans-serif;background:var(--bg);color:var(--text)}
    header{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.9);backdrop-filter:blur(8px);border-bottom:1px solid #e5e7eb}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    h1{margin:0;font-size:20px;letter-spacing:.5px}
    nav{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .tab{border:1px solid #e5e7eb;background:#fff;color:var(--text);padding:8px 12px;border-radius:12px;cursor:pointer}
    .tab.active{border-color:var(--brand);box-shadow:0 0 0 1px inset var(--brand)}
    main{padding:24px}
    section.card{background:var(--card);border:1px solid #e5e7eb;border-radius:16px;padding:20px;margin:18px 0}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:900px){.row{grid-template-columns:1fr}}
    label{display:block;font-weight:600;margin:10px 0 6px}
    input[type=text],input[type=date],input[type=email],select,textarea{width:100%;background:#fff;color:var(--text);border:1px solid #e5e7eb;border-radius:10px;padding:10px}
    textarea{min-height:88px}
    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:16px}
    button{border:1px solid #e5e7eb;background:#fff;color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer}
    button.primary{border-color:var(--brand);box-shadow:0 0 0 1px inset var(--brand)}
    .muted{color:var(--muted);font-size:12px}
    .toast{position:fixed;right:16px;bottom:16px;padding:10px 14px;background:#fff;border:1px solid #e5e7eb;border-radius:12px}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{text-align:left;border-bottom:1px solid #e5e7eb;padding:6px}
    /* é«˜äº®å·²é¸çš„å–®é¸æ¡†æ‰€åœ¨å„²å­˜æ ¼ï¼ˆç¾ä»£ç€è¦½å™¨æ”¯æ´ :hasï¼‰ */
    td:has(input[type=radio]:checked){background:var(--active)}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
        <h1>MONA Onboarding Feedbackï½œæ–°é€²å“¡å·¥è¨“ç·´å›é¥‹ç³»çµ±</h1>
        <span class="muted">ä½¿ç”¨è€…IDï¼š<strong id="userIdBadge">æœªè¨­å®š</strong></span>
      </div>
      <nav id="tabs" style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap"></nav>
    </div>
  </header>
  <main class="wrap">
    <section id="tab-0" class="card">
      <h2>ğŸ”‘ åŸºæœ¬è³‡è¨Š</h2>
      <div class="row">
        <div>
          <label>ä½¿ç”¨è€…ä»£è™Ÿï¼ˆemployeeIdï¼‰</label>
          <input id="employeeId" type="text" placeholder="ä¾‹å¦‚ï¼šVHC-2025-001" />
        </div>
        <div>
          <label>å§“å</label>
          <input id="fullName" type="text" placeholder="ä¾‹å¦‚ï¼šç‹å°æ˜" />
        </div>
      </div>
      <div class="row">
        <div>
          <label>å–®ä½ / éƒ¨é–€</label>
          <input id="dept" type="text" placeholder="ä¾‹å¦‚ï¼šè»Šè¼›èª²ï¼è»ŒåœŸèª²ï¼é€šè™Ÿèª²" />
        </div>
        <div>
          <label>ä»Šå¤©æ—¥æœŸ</label>
          <input id="date" type="date" />
          <div class="btns"><button id="fillToday" type="button">å¡«å…¥ä»Šå¤©</button></div>
        </div>
      </div>
    </section>

    <section id="tab-1" class="card">
      <h2>ğŸ©µ åˆæœŸè¨“ç·´å•å·</h2>
      <p>è«‹é‡å°ä»¥ä¸‹äº”é …æŒ‡æ¨™é€²è¡Œè©•åˆ†ï¼ˆ1åˆ†ï¼éå¸¸ä¸åŒæ„ï¼Œ5åˆ†ï¼éå¸¸åŒæ„ï¼‰ï¼š</p>
      <table>
        <tr><th>é¡Œç›®</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th></tr>
        <tr><td>1. æˆ‘æ¸…æ¥šäº†è§£å–®ä½çš„é‹ä½œæ–¹å¼èˆ‡äººå“¡åˆ†å·¥ã€‚</td><td><input type="radio" name="loc1" value="1"></td><td><input type="radio" name="loc1" value="2"></td><td><input type="radio" name="loc1" value="3"></td><td><input type="radio" name="loc1" value="4"></td><td><input type="radio" name="loc1" value="5"></td></tr>
        <tr><td>2. æˆ‘èƒ½æŒæ¡è‡ªèº«å·¥ä½œå…§å®¹çš„é‡é»èˆ‡æµç¨‹ã€‚</td><td><input type="radio" name="loc2" value="1"></td><td><input type="radio" name="loc2" value="2"></td><td><input type="radio" name="loc2" value="3"></td><td><input type="radio" name="loc2" value="4"></td><td><input type="radio" name="loc2" value="5"></td></tr>
        <tr><td>3. æˆ‘å°ç›®å‰çš„å·¥ä½œç’°å¢ƒæ„Ÿåˆ°é©æ‡‰è‰¯å¥½ã€‚</td><td><input type="radio" name="loc3" value="1"></td><td><input type="radio" name="loc3" value="2"></td><td><input type="radio" name="loc3" value="3"></td><td><input type="radio" name="loc3" value="4"></td><td><input type="radio" name="loc3" value="5"></td></tr>
        <tr><td>4. æˆ‘èˆ‡åŒäº‹ä¹‹é–“çš„äº’å‹•åˆä½œé †åˆ©ã€‚</td><td><input type="radio" name="loc4" value="1"></td><td><input type="radio" name="loc4" value="2"></td><td><input type="radio" name="loc4" value="3"></td><td><input type="radio" name="loc4" value="4"></td><td><input type="radio" name="loc4" value="5"></td></tr>
        <tr><td>5. æˆ‘èªç‚ºåˆæœŸè¨“ç·´çš„å…§å®¹èƒ½å¹«åŠ©æˆ‘é †åˆ©é€²å…¥å·¥ä½œç‹€æ…‹ã€‚</td><td><input type="radio" name="loc5" value="1"></td><td><input type="radio" name="loc5" value="2"></td><td><input type="radio" name="loc5" value="3"></td><td><input type="radio" name="loc5" value="4"></td><td><input type="radio" name="loc5" value="5"></td></tr>
      </table>
      <label>é–‹æ”¾æ„è¦‹</label>
      <textarea id="locate-open" placeholder="è«‹æä¾›å…¶ä»–æ„è¦‹æˆ–å»ºè­°"></textarea>
      <div class="btns"><button class="primary" id="submitLocate" type="button">é€å‡ºåˆæœŸå•å·</button></div>
    </section>

    <section id="tab-2" class="card">
      <h2>ğŸ’¡ ä¸­æœŸæŠ€èƒ½èª²ç¨‹å›é¥‹</h2>
      <p>è«‹è©•ä¼°ä»¥ä¸‹å­¸ç¿’æˆæ•ˆï¼ˆ1åˆ†ï¼éå¸¸ä¸åŒæ„ï¼Œ5åˆ†ï¼éå¸¸åŒæ„ï¼‰ï¼š</p>
      <table>
        <tr><th>é¡Œç›®</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th></tr>
        <tr><td>1. æŠ€èƒ½èª²ç¨‹çš„å…§å®¹èƒ½æ‡‰ç”¨æ–¼å¯¦éš›å·¥ä½œã€‚</td><td><input type="radio" name="sk1" value="1"></td><td><input type="radio" name="sk1" value="2"></td><td><input type="radio" name="sk1" value="3"></td><td><input type="radio" name="sk1" value="4"></td><td><input type="radio" name="sk1" value="5"></td></tr>
        <tr><td>2. æ•™å­¸æ–¹å¼èƒ½æœ‰æ•ˆå¹«åŠ©æˆ‘ç†è§£å…§å®¹ã€‚</td><td><input type="radio" name="sk2" value="1"></td><td><input type="radio" name="sk2" value="2"></td><td><input type="radio" name="sk2" value="3"></td><td><input type="radio" name="sk2" value="4"></td><td><input type="radio" name="sk2" value="5"></td></tr>
        <tr><td>3. æˆ‘èƒ½ç†Ÿç·´æ“ä½œèª²ç¨‹ä¸­å­¸åˆ°çš„æŠ€èƒ½ã€‚</td><td><input type="radio" name="sk3" value="1"></td><td><input type="radio" name="sk3" value="2"></td><td><input type="radio" name="sk3" value="3"></td><td><input type="radio" name="sk3" value="4"></td><td><input type="radio" name="sk3" value="5"></td></tr>
        <tr><td>4. èª²ç¨‹æ™‚é–“èˆ‡é€²åº¦å®‰æ’åˆç†ã€‚</td><td><input type="radio" name="sk4" value="1"></td><td><input type="radio" name="sk4" value="2"></td><td><input type="radio" name="sk4" value="3"></td><td><input type="radio" name="sk4" value="4"></td><td><input type="radio" name="sk4" value="5"></td></tr>
        <tr><td>5. æˆ‘é¡˜æ„æ¨è–¦æ­¤èª²ç¨‹çµ¦å…¶ä»–åŒä»ã€‚</td><td><input type="radio" name="sk5" value="1"></td><td><input type="radio" name="sk5" value="2"></td><td><input type="radio" name="sk5" value="3"></td><td><input type="radio" name="sk5" value="4"></td><td><input type="radio" name="sk5" value="5"></td></tr>
      </table>
      <label>é–‹æ”¾æ„è¦‹</label>
      <textarea id="skill-open" placeholder="è«‹æä¾›å…¶ä»–æ„è¦‹æˆ–å»ºè­°"></textarea>
      <div class="btns"><button class="primary" id="submitSkill" type="button">é€å‡ºä¸­æœŸå•å·</button></div>
    </section>

    <section id="tab-3" class="card">
      <h2>ğŸ”¶ å¾ŒæœŸ360åº¦è©•ä¼°</h2>
      <div class="row" style="margin-bottom:8px">
        <div>
          <label>360 è§’è‰²</label>
          <select id="raterRole">
            <option value="self">è‡ªè©•</option>
            <option value="manager">ç›´å±¬ä¸»ç®¡</option>
            <option value="peer">åŒå„•</option>
            <option value="mentor">å°å¸«/æ•™ç·´</option>
          </select>
        </div>
        <div>
          <label>è©•ä¼°å°è±¡ï¼ˆemployeeIdï¼‰</label>
          <input id="rateeId" type="text" placeholder="è‹¥è‡ªè©•å¯ç•™æœ¬äºº ID" />
        </div>
      </div>
      <p>è«‹é‡å°å—è©•è€…é€²è¡Œç¶œåˆè©•ä¼°ï¼ˆ1åˆ†ï¼éå¸¸ä¸åŒæ„ï¼Œ5åˆ†ï¼éå¸¸åŒæ„ï¼‰ï¼š</p>
      <table>
        <tr><th>é¡Œç›®</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th></tr>
        <tr><td>1. èƒ½èˆ‡åŒäº‹ä¿æŒè‰¯å¥½æºé€šèˆ‡å”ä½œã€‚</td><td><input type="radio" name="gr1" value="1"></td><td><input type="radio" name="gr1" value="2"></td><td><input type="radio" name="gr1" value="3"></td><td><input type="radio" name="gr1" value="4"></td><td><input type="radio" name="gr1" value="5"></td></tr>
        <tr><td>2. å·¥ä½œæ…‹åº¦ç©æ¥µä¸”å…·è²¬ä»»æ„Ÿã€‚</td><td><input type="radio" name="gr2" value="1"></td><td><input type="radio" name="gr2" value="2"></td><td><input type="radio" name="gr2" value="3"></td><td><input type="radio" name="gr2" value="4"></td><td><input type="radio" name="gr2" value="5"></td></tr>
        <tr><td>3. èƒ½ä¸»å‹•æå‡ºæ”¹å–„å»ºè­°æˆ–è§£æ±ºå•é¡Œã€‚</td><td><input type="radio" name="gr3" value="1"></td><td><input type="radio" name="gr3" value="2"></td><td><input type="radio" name="gr3" value="3"></td><td><input type="radio" name="gr3" value="4"></td><td><input type="radio" name="gr3" value="5"></td></tr>
        <tr><td>4. åœ¨å£“åŠ›ä¸‹ä»èƒ½ç¶­æŒç©©å®šè¡¨ç¾ã€‚</td><td><input type="radio" name="gr4" value="1"></td><td><input type="radio" name="gr4" value="2"></td><td><input type="radio" name="gr4" value="3"></td><td><input type="radio" name="gr4" value="4"></td><td><input type="radio" name="gr4" value="5"></td></tr>
        <tr><td>5. æ•´é«”è¡¨ç¾ç¬¦åˆå–®ä½æœŸæœ›ã€‚</td><td><input type="radio" name="gr5" value="1"></td><td><input type="radio" name="gr5" value="2"></td><td><input type="radio" name="gr5" value="3"></td><td><input type="radio" name="gr5" value="4"></td><td><input type="radio" name="gr5" value="5"></td></tr>
      </table>
      <label>è£œå……èªªæ˜ï¼ˆè³ªæ€§æ„è¦‹ï¼‰</label>
      <textarea id="grow-open" placeholder="è«‹å…·é«”æè¿°å—è©•è€…çš„å„ªå‹¢è¡¨ç¾ã€å¾…æ”¹é€²ä¹‹è™•æˆ–å…¶ä»–è§€å¯Ÿ"></textarea>
      <div class="btns"><button class="primary" id="submitGrow" type="button">é€å‡ºå…¨æ–¹ä½è©•ä¼°å•å·</button></div>
    </section>

    <section id="tab-4" class="card">
      <h2>ğŸ’¬ æ„è¦‹åæ˜ </h2>
      <div class="row">
        <div>
          <label>ç•™è¨€å…§å®¹</label>
          <textarea id="msgBody" placeholder="é‡åˆ°çš„å›°é›£æˆ–å»ºè­°"></textarea>
        </div>
        <div>
          <label>æ˜¯å¦åŒ¿å</label>
          <select id="msgAnon"><option value="yes">åŒ¿å</option><option value="no">ç½²å</option></select>
          <div class="btns"><button class="primary" id="submitMsg" type="button">é€å‡ºç•™è¨€</button></div>
        </div>
      </div>
    </section>
    
    <!-- ğŸ—“ æ¯å‘¨å•å· -->
    <section id="tab-6" class="card">
      <h2>ğŸ—“ æ¯å‘¨å•å·</h2>
      <p>è«‹ä»¥äº”é»é‡è¡¨ä½œç­”ï¼ˆ1ï¼éå¸¸ä¸åŒæ„ï¼Œ5ï¼éå¸¸åŒæ„ï¼‰ï¼Œä¸¦å®Œæˆä¸‹æ–¹å…©é¡Œé–‹æ”¾é¡Œï¼š</p>
      <table>
        <tr><th>é¡Œç›®</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th></tr>
        <tr><td>1. æœ¬é€±æˆ‘èƒ½é †åˆ©å®Œæˆåˆ†é…çš„ä»»å‹™èˆ‡ä½œæ¥­ã€‚</td>
          <td><input type="radio" name="wk1" value="1"></td><td><input type="radio" name="wk1" value="2"></td><td><input type="radio" name="wk1" value="3"></td><td><input type="radio" name="wk1" value="4"></td><td><input type="radio" name="wk1" value="5"></td></tr>
        <tr><td>2. æˆ‘è¦ºå¾—è‡ªå·±æ¯”ä¸Šé€±æ›´ç†Ÿæ‚‰å·¥ä½œæµç¨‹ã€‚</td>
          <td><input type="radio" name="wk2" value="1"></td><td><input type="radio" name="wk2" value="2"></td><td><input type="radio" name="wk2" value="3"></td><td><input type="radio" name="wk2" value="4"></td><td><input type="radio" name="wk2" value="5"></td></tr>
        <tr><td>3. ç•¶å·¥ä½œä¸­å‡ºç¾å•é¡Œæ™‚ï¼Œæˆ‘èƒ½æ¸…æ¥šçŸ¥é“è§£æ±ºæ–¹å‘ã€‚</td>
          <td><input type="radio" name="wk3" value="1"></td><td><input type="radio" name="wk3" value="2"></td><td><input type="radio" name="wk3" value="3"></td><td><input type="radio" name="wk3" value="4"></td><td><input type="radio" name="wk3" value="5"></td></tr>
        <tr><td>4. æœ¬é€±èˆ‡å‰è¼©æˆ–åŒäº‹çš„åˆä½œäº’å‹•é †åˆ©ã€‚</td>
          <td><input type="radio" name="wk4" value="1"></td><td><input type="radio" name="wk4" value="2"></td><td><input type="radio" name="wk4" value="3"></td><td><input type="radio" name="wk4" value="4"></td><td><input type="radio" name="wk4" value="5"></td></tr>
        <tr><td>5. æˆ‘åœ¨ç¾å ´è§€å¯Ÿåˆ°æ–°çš„çŸ¥è­˜æˆ–æŠ€å·§ï¼Œä¸¦é¡˜æ„ä¸»å‹•å­¸ç¿’ã€‚</td>
          <td><input type="radio" name="wk5" value="1"></td><td><input type="radio" name="wk5" value="2"></td><td><input type="radio" name="wk5" value="3"></td><td><input type="radio" name="wk5" value="4"></td><td><input type="radio" name="wk5" value="5"></td></tr>
        <tr><td>6. æˆ‘è¦ºå¾—è‡ªå·±çš„å°ˆæ³¨åŠ›èˆ‡é«”åŠ›èƒ½æ‡‰ä»˜ç›®å‰çš„è¨“ç·´éœ€æ±‚ã€‚</td>
          <td><input type="radio" name="wk6" value="1"></td><td><input type="radio" name="wk6" value="2"></td><td><input type="radio" name="wk6" value="3"></td><td><input type="radio" name="wk6" value="4"></td><td><input type="radio" name="wk6" value="5"></td></tr>
        <tr><td>7. æˆ‘è¦ºå¾—ç›®å‰çš„èª²ç¨‹å®‰æ’èˆ‡å¯¦ä½œæ¯”ä¾‹é©åˆæˆ‘çš„å­¸ç¿’æ­¥èª¿ã€‚</td>
          <td><input type="radio" name="wk7" value="1"></td><td><input type="radio" name="wk7" value="2"></td><td><input type="radio" name="wk7" value="3"></td><td><input type="radio" name="wk7" value="4"></td><td><input type="radio" name="wk7" value="5"></td></tr>
        <tr><td>8. åŸ¹è¨“è³‡è¨Šï¼ˆå¦‚æ™‚é–“ã€åœ°é»ã€å…§å®¹ï¼‰æ˜¯å¦æ¸…æ¥šä¸”å®¹æ˜“å–å¾—ï¼Ÿ</td>
          <td><input type="radio" name="wk8" value="1"></td><td><input type="radio" name="wk8" value="2"></td><td><input type="radio" name="wk8" value="3"></td><td><input type="radio" name="wk8" value="4"></td><td><input type="radio" name="wk8" value="5"></td></tr>
      </table>

      <label>9. è«‹å¯«ä¸‹æœ¬é€±è®“ä½ å°è±¡æœ€æ·±çš„ä¸€é …å­¸ç¿’ç¶“é©—æˆ–çªç ´ã€‚</label>
      <textarea id="wk-open1" placeholder="è«‹å…·é«”æè¿°ä½ å­¸åˆ°äº†ä»€éº¼ã€å¦‚ä½•çªç ´ã€é€ æˆå½±éŸ¿æ˜¯ä»€éº¼"></textarea>

      <label>10. å°ä¸‹é€±çš„èª²ç¨‹æˆ–å®‰æ’ï¼Œæ‚¨æœ‰ä»€éº¼å»ºè­°æˆ–å¸Œæœ›æ”¹é€²çš„åœ°æ–¹ï¼Ÿ</label>
      <textarea id="wk-open2" placeholder="è«‹æå‡ºå…·é«”å¯è¡Œçš„å»ºè­°ï¼ˆå¦‚èª¿æ•´é€²åº¦ã€è£œå……æ•™æã€æƒ…å¢ƒæ¼”ç·´ç­‰ï¼‰"></textarea>

      <div class="btns">
        <button class="primary" id="submitWeekly" type="button">é€å‡ºæ¯å‘¨å•å·</button>
      </div>
    </section>
    
    <section id="tab-5" class="card">
      <h2>ğŸ› ï¸ ç®¡ç†è¨­å®šï¼ˆAdminï¼‰</h2>
      <p class="muted">è¼¸å…¥é‡‘é‘°å¾Œå¯ç·¨è¼¯ GAS URLï¼›é è¨­å·²è¨­å®šç‚ºä½ çš„ /execã€‚</p>
      <div class="row">
        <div>
          <label>ç®¡ç†é‡‘é‘°</label>
          <input id="adminKey" type="password" placeholder="è¼¸å…¥ï¼šMONAADMIN2025" />
          <div class="btns"><button id="adminUnlock" type="button">å•Ÿç”¨ç·¨è¼¯</button></div>
        </div>
        <div>
          <label>GAS Web App URLï¼ˆ/execï¼‰</label>
          <input id="gas_url" type="text" value="https://script.google.com/macros/s/AKfycbylnQs-FaohoCe0wdEw_xQyhLNX0jq_Hcou3Ndxgfq1YdPcs4114PNTp64b619qUpGa/exec" readonly />
          <div class="btns"><button id="gasTestBtn" type="button">æ¸¬è©¦é€£ç·šï¼ˆPINGï¼‰</button></div>
        </div>
      </div>
    </section>
  </main>
  <script>
  const ADMIN_KEY = 'MONAADMIN';
  const STORAGE_KEY = 'mona_onboarding_cfg_v4';
  let profile = {
    employeeId:'', fullName:'', dept:'', date:'',
    api:{ gasUrl:'https://script.google.com/macros/s/AKfycbylnQs-FaohoCe0wdEw_xQyhLNX0jq_Hcou3Ndxgfq1YdPcs4114PNTp64b619qUpGa/exec' }
  };

  function toast(msg){const el=document.createElement('div');el.className='toast';el.textContent=msg;document.body.appendChild(el);setTimeout(()=>el.remove(),2200);}  

  /* ===== Tabs ===== */
 function renderTabs(){
  const tabsHost = document.getElementById('tabs');
  const specs = [
    {id:'tab-0', name:'åŸºæœ¬è³‡è¨Š'},
    {id:'tab-1', name:'åˆæœŸè¨“ç·´'},
    {id:'tab-2', name:'ä¸­æœŸæŠ€èƒ½'},
    {id:'tab-3', name:'å¾ŒæœŸ360'},
    {id:'tab-6', name:'æ¯å‘¨å•å·'}, // â˜… æ–°å¢
    {id:'tab-4', name:'æ„è¦‹åæ˜ '},
    {id:'tab-5', name:'ç®¡ç†è¨­å®š'}
  ];
  window.__TAB_SPECS = specs;
  tabsHost.innerHTML = '';
  specs.forEach((t, i)=>{
    const btn = document.createElement('button');
    btn.className = 'tab'+(i===0?' active':'');
    btn.textContent = t.name;
    btn.addEventListener('click', ()=> switchTab(i));
    tabsHost.appendChild(btn);
  });
function switchTab(index){
  const specs = window.__TAB_SPECS || [];
  const tabs = document.getElementById('tabs').children;
  for(let i=0;i<tabs.length;i++) tabs[i].classList.toggle('active', i===index);
  specs.forEach((t, i)=>{
    const sec = document.getElementById(t.id);
    if(!sec) return;
    sec.style.display = (i===index) ? 'block' : 'none';
  });
  // åŒæ­¥ URL hashï¼ˆé †åºéœ€èˆ‡ specs å°é½Šï¼‰
  const names = ['basic','locate','skill','grow360','weekly','messages','admin']; // â˜…
  const h = names[index] || 'basic';
  if(location.hash !== '#'+h) history.replaceState(null, '', '#'+h);
}

function applyHash(){
  const map = { basic:0, locate:1, skill:2, grow360:3, weekly:4, messages:5, admin:6 }; // â˜…
  const key = (location.hash||'').replace('#','');
  switchTab(map[key] ?? 0);
}

  /* ===== Basic ===== */
  function readBasic(){
    profile.employeeId = document.getElementById('employeeId').value.trim();
    profile.fullName = document.getElementById('fullName').value.trim();
    profile.dept = document.getElementById('dept').value.trim();
    const d = document.getElementById('date').value;
    profile.date = d || new Date().toISOString().slice(0,10);
    document.getElementById('userIdBadge').textContent = profile.employeeId || 'æœªè¨­å®š';
  }

  /* ===== Gather scores (table radios) ===== */
    function readGroup(prefix, count=5){
    const out = [];
    for(let i=1;i<=count;i++){
      const r = document.querySelector(`input[name='${prefix}${i}']:checked`);
      out.push(r ? Number(r.value) : null);
    }
    return out;
  }

    function validate(kind){
    readBasic();
    if(!profile.employeeId){ toast('è«‹å…ˆæ–¼ã€ŒåŸºæœ¬è³‡è¨Šã€å¡«å¯«ä½¿ç”¨è€…ä»£è™Ÿ'); switchTab(0); return false; }
    const groups = { locate:'loc', skill:'sk', grow360:'gr', weekly:'wk' };
    const counts = { locate:5, skill:5, grow360:5, weekly:8 };
    const g = groups[kind];
    const vals = readGroup(g, counts[kind] || 5);
    const miss = vals.map((v,i)=> (v==null)?(i+1):null).filter(Boolean);
    if(miss.length){ toast(`è«‹å®Œæˆç¬¬ ${miss.join(', ')} é¡Œ`); return false; }
    if(kind==='grow360'){
      const ratee = (document.getElementById('rateeId').value.trim() || profile.employeeId);
      if(!ratee){ toast('è«‹å¡«å¯«è©•ä¼°å°è±¡ employeeId'); return false; }
    }
    return true;
  }

  /* ===== GAS ===== */
  function isLikelyGas(url){ return /^https:\/\/script\.google\.com\/macros\/s\//.test(url) && /\/exec(\?|$)/.test(url); }
  async function submitToGAS(payload){
    const gas = (document.getElementById('gas_url')?.value || profile.api.gasUrl || '').trim();
    if(!isLikelyGas(gas)) throw new Error('GAS URL æ ¼å¼éŒ¯èª¤');
    const res = await fetch(gas + '?origin=' + encodeURIComponent(location.origin), {
      method:'POST', headers:{'Content-Type':'text/plain;charset=utf-8'}, body: JSON.stringify(payload)
    });
    if(!res.ok) throw new Error('GAS å›æ‡‰é 200');
    return true;
  }

  /* ===== Submit handlers ===== */
  async function submitLocate(){
    if(!validate('locate')) return;
    const payload = { module:'locate', employeeId:profile.employeeId, fullName:profile.fullName, dept:profile.dept, date:profile.date, ts:Date.now(), scores: readGroup('loc'), open: document.getElementById('locate-open').value.trim() };
    const btn = document.getElementById('submitLocate'); const old=btn.textContent; btn.disabled=true; btn.textContent='å‚³é€ä¸­â€¦';
    try{ await submitToGAS(payload); btn.textContent='âœ” å·²é€å‡º'; toast('åˆæœŸå•å·å·²é€å‡º'); switchTab(0); }catch(e){ console.error(e); btn.disabled=false; btn.textContent=old; toast('é€å‡ºå¤±æ•—'); }
  }
  async function submitSkill(){
    if(!validate('skill')) return;
    const payload = { module:'skill', employeeId:profile.employeeId, fullName:profile.fullName, dept:profile.dept, date:profile.date, ts:Date.now(), scores: readGroup('sk'), open: document.getElementById('skill-open').value.trim(), quizScore:0, quizTotal:0 };
    const btn = document.getElementById('submitSkill'); const old=btn.textContent; btn.disabled=true; btn.textContent='å‚³é€ä¸­â€¦';
    try{ await submitToGAS(payload); btn.textContent='âœ” å·²é€å‡º'; toast('ä¸­æœŸå•å·å·²é€å‡º'); switchTab(0); }catch(e){ console.error(e); btn.disabled=false; btn.textContent=old; toast('é€å‡ºå¤±æ•—'); }
  }
  async function submitGrow(){
    if(!validate('grow360')) return;
    const payload = {
      module:'grow360',
      employeeId:profile.employeeId,
      fullName:profile.fullName,
      dept:profile.dept,
      date:profile.date,
      ts:Date.now(),
      scores: readGroup('gr'),
      role: document.getElementById('raterRole').value,
      rateeId: (document.getElementById('rateeId').value.trim() || profile.employeeId),
      open: document.getElementById('grow-open').value.trim()   // â˜… åŠ ä¸Šè³ªæ€§æ¬„ä½
    };
    const btn = document.getElementById('submitGrow'); const old=btn.textContent; btn.disabled=true; btn.textContent='å‚³é€ä¸­â€¦';
    try{ await submitToGAS(payload); btn.textContent='âœ” å·²é€å‡º'; toast('å…¨æ–¹ä½å•å·å·²é€å‡º'); switchTab(0); }catch(e){ console.error(e); btn.disabled=false; btn.textContent=old; toast('é€å‡ºå¤±æ•—'); }
  }
  async function submitMsg(){
    readBasic(); if(!profile.employeeId){ toast('è«‹å…ˆæ–¼ã€ŒåŸºæœ¬è³‡è¨Šã€å¡«å¯«ä½¿ç”¨è€…ä»£è™Ÿ'); switchTab(0); return; }
    const body = document.getElementById('msgBody').value.trim(); if(!body){ toast('è«‹è¼¸å…¥ç•™è¨€å…§å®¹'); return; }
    const payload = { module:'messages', employeeId:(document.getElementById('msgAnon').value==='yes'?'åŒ¿å':profile.employeeId), fullName:profile.fullName, dept:profile.dept, date:profile.date, ts:Date.now(), body };
    const btn = document.getElementById('submitMsg'); const old=btn.textContent; btn.disabled=true; btn.textContent='å‚³é€ä¸­â€¦';
    try{ await submitToGAS(payload); btn.textContent='âœ” å·²é€å‡º'; document.getElementById('msgBody').value=''; toast('ç•™è¨€å·²é€å‡º'); switchTab(0); }catch(e){ console.error(e); btn.disabled=false; btn.textContent=old; toast('é€å‡ºå¤±æ•—'); }
  }

  async function submitWeekly(){
    if(!validate('weekly')) return;
    const payload = {
      module:'weekly',
      employeeId:profile.employeeId,
      fullName:profile.fullName,
      dept:profile.dept,
      date:profile.date,
      ts:Date.now(),
      scores: readGroup('wk', 8),
      open1: document.getElementById('wk-open1').value.trim(),
      open2: document.getElementById('wk-open2').value.trim()
    };
    const btn = document.getElementById('submitWeekly'); const old=btn.textContent;
    btn.disabled=true; btn.textContent='å‚³é€ä¸­â€¦';
    try{
      await submitToGAS(payload);
      btn.textContent='âœ” å·²é€å‡º';
      toast('æ¯å‘¨å•å·å·²é€å‡º');
      switchTab(0);
    }catch(e){
      console.error(e);
      btn.disabled=false; btn.textContent=old;
      toast('é€å‡ºå¤±æ•—');
    }
  }

  /* ===== Admin unlock & test ===== */
  function unlockAdmin(){
    const key = document.getElementById('adminKey').value.trim();
    if(key!==ADMIN_KEY) return toast('é‡‘é‘°éŒ¯èª¤');
    const input = document.getElementById('gas_url');
    input.removeAttribute('readonly');
    toast('å·²è§£é– GAS URL å¯ç·¨è¼¯');
  }
  async function testGas(){
    const url = document.getElementById('gas_url').value.trim();
    if(!isLikelyGas(url)) return toast('GAS URL æ ¼å¼éŒ¯èª¤');
    try{ const r = await fetch(url,{method:'GET'}); toast(r.ok?'PING OK':'PING å¤±æ•—'); }catch(_){ toast('PING å¤±æ•—'); }
  }

  /* ===== init ===== */
  function init(){
  renderTabs();
  ['tab-1','tab-2','tab-3','tab-4','tab-5','tab-6'].forEach(id=>{ // â˜…
    const el = document.getElementById(id);
    if(el) el.style.display='none';
  });
  applyHash();
  window.addEventListener('hashchange', applyHash);

    const today = new Date().toISOString().slice(0,10);
    document.getElementById('date').value = today;
    document.getElementById('fillToday').addEventListener('click', ()=>{ document.getElementById('date').value = new Date().toISOString().slice(0,10); readBasic(); });
    ['employeeId','fullName','dept','date'].forEach(id=> document.getElementById(id).addEventListener('input', readBasic));
    readBasic();

    document.getElementById('submitLocate').addEventListener('click', submitLocate);
    document.getElementById('submitSkill').addEventListener('click', submitSkill);
    document.getElementById('submitGrow').addEventListener('click', submitGrow);
    document.getElementById('submitMsg').addEventListener('click', submitMsg);
    document.getElementById('adminUnlock').addEventListener('click', unlockAdmin);
    document.getElementById('gasTestBtn').addEventListener('click', testGas);
    document.getElementById('submitWeekly').addEventListener('click', submitWeekly);
  }
  init();
  </script>
</body>
</html>
